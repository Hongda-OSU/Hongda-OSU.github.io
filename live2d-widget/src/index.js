"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _model=_interopRequireDefault(require("./model.js")),_message=_interopRequireDefault(require("./message.js")),_utils=_interopRequireDefault(require("./utils.js")),_tools=_interopRequireDefault(require("./tools.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _createForOfIteratorHelper(e,t){var n,o,r,a,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return o=!(n=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return n=e.done,e},e:function(e){o=!0,r=e},f:function(){try{n||null==i.return||i.return()}finally{if(o)throw r}}};if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),a=0,{s:t=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function loadWidget(e){var t,n,o=new _model.default(e);localStorage.removeItem("waifu-display"),sessionStorage.removeItem("waifu-text"),document.body.insertAdjacentHTML("beforeend",'<div id="waifu">\n            <div id="waifu-tips"></div>\n            <canvas id="live2d" width="800" height="800"></canvas>\n            <div id="waifu-tool"></div>\n        </div>'),setTimeout(function(){document.getElementById("waifu").style.bottom=0},0),_tools.default["switch-model"].callback=function(){return o.loadOtherModel()},_tools.default["switch-texture"].callback=function(){return o.loadRandModel()},Array.isArray(e.tools)||(e.tools=Object.keys(_tools.default));var r,a=_createForOfIteratorHelper(e.tools);try{for(a.s();!(r=a.n()).done;){var i,l,u,s=r.value;_tools.default[s]&&(l=(i=_tools.default[s]).icon,u=i.callback,document.getElementById("waifu-tool").insertAdjacentHTML("beforeend",'<span id="waifu-tool-'.concat(s,'">').concat(l,"</span>")),document.getElementById("waifu-tool-".concat(s)).addEventListener("click",u))}}catch(e){a.e(e)}finally{a.f()}function d(i){function e(){}var t,l,n=!1,r=i.message.default;window.addEventListener("mousemove",function(){return n=!0}),window.addEventListener("keydown",function(){return n=!0}),setInterval(function(){t=n?(n=!1,clearInterval(t),null):t||setInterval(function(){(0,_message.default)(r,6e3,9)},2e4)},1e3),(0,_message.default)(function(e){if("/"===location.pathname){var t,n=_createForOfIteratorHelper(e);try{for(n.s();!(t=n.n()).done;){var o=t.value,r=o.hour,a=o.text,i=new Date,l=r.split("-")[0],u=r.split("-")[1]||l;if(l<=i.getHours()&&i.getHours()<=u)return a}}catch(e){n.e(e)}finally{n.f()}}var s,d,c,e="欢迎阅读<span>「".concat(document.title.split(" - ")[0],"」</span>");return""===document.referrer||(d=(s=new URL(document.referrer)).hostname.split(".")[1],c={baidu:"百度",so:"360搜索",google:"谷歌搜索"},location.hostname===s.hostname)?e:(c=d in c?c[d]:s.hostname,"Hello！来自 <span>".concat(c,"</span> 的朋友<br>").concat(e))}(i.time),7e3,11),window.addEventListener("mouseover",function(e){var t,n=_createForOfIteratorHelper(i.mouseover);try{for(n.s();!(t=n.n()).done;){var o=t.value,r=o.selector,a=o.text;if(e.target.closest(r))return l===r?void 0:(l=r,a=(a=(0,_utils.default)(a)).replace("{text}",e.target.innerText),void(0,_message.default)(a,4e3,8))}}catch(e){n.e(e)}finally{n.f()}}),window.addEventListener("click",function(e){var t,n=_createForOfIteratorHelper(i.click);try{for(n.s();!(t=n.n()).done;){var o=t.value,r=o.selector,a=o.text;if(e.target.closest(r))return a=(a=(0,_utils.default)(a)).replace("{text}",e.target.innerText),void(0,_message.default)(a,4e3,8)}}catch(e){n.e(e)}finally{n.f()}}),i.seasons.forEach(function(e){var t=e.date,e=e.text,n=new Date,o=t.split("-")[0],t=t.split("-")[1]||o;o.split("/")[0]<=n.getMonth()+1&&n.getMonth()+1<=t.split("/")[0]&&o.split("/")[1]<=n.getDate()&&n.getDate()<=t.split("/")[1]&&(e=(e=(0,_utils.default)(e)).replace("{year}",n.getFullYear()),r.push(e))});console.log("%c",e),e.toString=function(){(0,_message.default)(i.message.console,6e3,9)},window.addEventListener("copy",function(){(0,_message.default)(i.message.copy,6e3,9)}),window.addEventListener("visibilitychange",function(){document.hidden||(0,_message.default)(i.message.visibilitychange,6e3,9)})}t=localStorage.getItem("modelId"),n=localStorage.getItem("modelTexturesId"),null===t&&(t=1,n=53),o.loadModel(t,n),fetch(e.waifuPath).then(function(e){return e.json()}).then(d)}function initWidget(e,t){"string"==typeof e&&(e={waifuPath:e,apiPath:t}),document.body.insertAdjacentHTML("beforeend",'<div id="waifu-toggle">\n            <span>看板娘</span>\n        </div>');var n=document.getElementById("waifu-toggle");n.addEventListener("click",function(){n.classList.remove("waifu-toggle-active"),n.getAttribute("first-time")?(loadWidget(e),n.removeAttribute("first-time")):(localStorage.removeItem("waifu-display"),document.getElementById("waifu").style.display="",setTimeout(function(){document.getElementById("waifu").style.bottom=0},0))}),localStorage.getItem("waifu-display")&&Date.now()-localStorage.getItem("waifu-display")<=864e5?(n.setAttribute("first-time",!0),setTimeout(function(){n.classList.add("waifu-toggle-active")},0)):loadWidget(e)}var _default=initWidget;exports.default=_default;